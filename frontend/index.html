<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecommerce Product Viewer - Hybrid Approach</title>
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Axios for API calls -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- JWT Decoder -->
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div id="app">
    <header>
        <h1>Ecommerce Products</h1>
        <div v-if="!authenticated">
            <button @click="login">Login</button>
        </div>
        <div v-else>
            <span>Welcome, {{ username }}</span>
            <button @click="logout">Logout</button>
        </div>
    </header>

    <main>
        <div v-if="loading">Loading...</div>

        <div v-else-if="authenticated">
            <div v-if="isAdmin">
                <h2>Admin Controls</h2>
                <form @submit.prevent="createProduct">
                    <h3>Add New Product</h3>
                    <div>
                        <label for="name">Name:</label>
                        <input id="name" v-model="newProduct.name" required>
                    </div>
                    <div>
                        <label for="description">Description:</label>
                        <textarea id="description" v-model="newProduct.description" required></textarea>
                    </div>
                    <div>
                        <label for="price">Price:</label>
                        <input id="price" type="number" step="0.01" v-model="newProduct.price" required>
                    </div>
                    <div>
                        <label for="inventory">Inventory:</label>
                        <input id="inventory" type="number" v-model="newProduct.inventoryCount" required>
                    </div>
                    <div>
                        <label for="category">Category:</label>
                        <input id="category" v-model="newProduct.category" required>
                    </div>
                    <button type="submit">Add Product</button>
                </form>
            </div>

            <h2>Product List</h2>
            <div v-if="products.length === 0">No products found.</div>
            <ul v-else>
                <li v-for="product in products" :key="product.id">
                    <strong>{{ product.name }}</strong> - ${{ product.price }}
                    <p>{{ product.description }}</p>
                    <p>Category: {{ product.category }}</p>
                    <p>In Stock: {{ product.inventoryCount }}</p>
                    <div v-if="isAdmin">
                        <button @click="deleteProduct(product.id)">Delete</button>
                        <button @click="selectProductForEdit(product)">Edit</button>
                    </div>
                </li>
            </ul>

            <div v-if="isAdmin && selectedProduct">
                <h3>Edit Product</h3>
                <form @submit.prevent="updateProduct">
                    <div>
                        <label for="edit-name">Name:</label>
                        <input id="edit-name" v-model="selectedProduct.name" required>
                    </div>
                    <div>
                        <label for="edit-description">Description:</label>
                        <textarea id="edit-description" v-model="selectedProduct.description" required></textarea>
                    </div>
                    <div>
                        <label for="edit-price">Price:</label>
                        <input id="edit-price" type="number" step="0.01" v-model="selectedProduct.price" required>
                    </div>
                    <div>
                        <label for="edit-inventory">Inventory:</label>
                        <input id="edit-inventory" type="number" v-model="selectedProduct.inventoryCount" required>
                    </div>
                    <div>
                        <label for="edit-category">Category:</label>
                        <input id="edit-category" v-model="selectedProduct.category" required>
                    </div>
                    <button type="submit">Update</button>
                    <button type="button" @click="cancelEdit">Cancel</button>
                </form>
            </div>
        </div>

        <div v-else>
            <p>Please log in to view and manage products.</p>
        </div>
    </main>
</div>

<!-- Import Auth Service -->
<script src="js/authService.js"></script>
<!-- Import API Service -->
<script src="js/apiService.js"></script>
<!-- Main App Script -->
<script src="js/app.js"></script>
</body>
</html>